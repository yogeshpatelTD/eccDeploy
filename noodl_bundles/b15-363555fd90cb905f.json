[{"name":"/#Supabase Prefab/Supabase Prefab/User/Supabase - Sign Up","nodes":[{"id":"8cdb0e93-c248-8374-0b52-ea0b2998f2a4","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","type":"JavaScriptFunction","parameters":{"functionScript":"if (!Boolean(Noodl.Variables.supabase)) {\n  console.error(\"Supabase client is not configured !\");\n  return;\n}\n\n// Step 1: Save the current session (for the original user)\nconst { data: currentSessionData, error: sessionError } = await Noodl.Variables.supabase.auth.getSession();\n\nif (sessionError) {\n  console.error(\"Failed to get the current session:\", sessionError.message);\n  return;\n}\n\nconst currentSession = currentSessionData.session;\nif (!currentSession || !currentSession.access_token) {\n  console.error(\"No active session found!\");\n  return;\n}\n\n// Step 2: Sign up the new user\nlet { data, error } = await Noodl.Variables.supabase.auth.signUp({\n  email: Inputs.email,\n  password: Inputs.password,\n});\n\nconsole.log(\"[signup] data\", data);\nconsole.log(\"[signup] error\", error);\n\nif (error) {\n  Outputs.error = error.message;\n  Outputs.isConnected = false;\n  Outputs.Failure();\n} else {\n  // Step 3: Immediately log out the newly created user\n  await Noodl.Variables.supabase.auth.signOut();\n\n  // Step 4: Restore the original user's session by signing back in with the saved access token\n  await Noodl.Variables.supabase.auth.setSession({\n    access_token: currentSession.access_token,\n    refresh_token: currentSession.refresh_token,\n  });\n\n  // Handle new user data without switching the session\n  Outputs.data = data;\n  Outputs.email = data.user.email;\n  Outputs.id = data.user.id;\n  Outputs.isConnected = true; // Set to true if the original user session is restored\n  Outputs.Success();\n}\n"},"ports":[{"name":"in-email","displayName":"email","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-password","displayName":"password","plug":"input","type":"*","group":"Inputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":7},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":8},{"name":"out-isConnected","displayName":"isConnected","plug":"output","type":"*","group":"Outputs","index":9},{"name":"out-data","displayName":"data","plug":"output","type":"*","group":"Outputs","index":10},{"name":"out-email","displayName":"email","plug":"output","type":"*","group":"Outputs","index":11},{"name":"out-id","displayName":"id","plug":"output","type":"*","group":"Outputs","index":12}],"children":[]}],"connections":[{"sourceId":"8cdb0e93-c248-8374-0b52-ea0b2998f2a4","sourcePort":"Do","targetId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","targetPort":"run"},{"sourceId":"8cdb0e93-c248-8374-0b52-ea0b2998f2a4","sourcePort":"Email","targetId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","targetPort":"in-email"},{"sourceId":"8cdb0e93-c248-8374-0b52-ea0b2998f2a4","sourcePort":"Password","targetId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","targetPort":"in-password"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-Success","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"Success"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-Failure","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"Failure"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-data","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"Data"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-isConnected","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"Is Connected"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-error","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"Error"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-email","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"email"},{"sourceId":"37cbdccb-1fcb-d1cb-00e5-cdc5702fbf9b","sourcePort":"out-id","targetId":"a9a8cd6f-c19c-12a5-c50a-2b0a01ec8a07","targetPort":"id"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":0},{"name":"Failure","type":"signal","plug":"output","index":1},{"name":"Email","type":"*","group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"Password","type":"*","group":"Inputs","plug":"input","index":2},{"name":"Error","type":"*","plug":"output","index":3},{"name":"Is Connected","type":"*","plug":"output","index":4},{"name":"email","type":"*","plug":"output","index":5},{"name":"id","type":"*","plug":"output","index":6}],"roots":[]}]
[{"name":"/#Supabase Prefab/Supabase Prefab/User/Supabase - Log In","nodes":[{"id":"b643f904-ecb4-5bb2-8194-f6fdc77726fa","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"d54e86b2-f075-cf9e-e60e-54fec7d955b4","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","type":"JavaScriptFunction","parameters":{"functionScript":"//console.clear()\n\nif (!Boolean(Noodl.Variables.supabase)){\n    console.error(\"Supabase client not initialized\")\n    return\n}\n\nlet { data, error } = await Noodl.Variables.supabase.auth.signInWithPassword({\n  email: Inputs.email,\n  password: Inputs.password,\n})\n\nif (error) {\n\n  Noodl.Objects.currentUser.loggedIn = false\n\n  \n  Outputs.error = error.message\n\n  console.error(\"[log in] error: \", error)\n  Outputs.Failure()\n\n} else {\n\n  Outputs.data = data\n  Outputs.error = \"200\"\n  Noodl.Objects.currentUser.loggedIn = true\n  Noodl.Objects.currentUser.auth = data.user\n  Noodl.Objects.currentUser.session = data.session\n  //data.session.user.sbid = data.session.user.id\n  //Noodl.Objects.currentUser.setAll(data)\n\n  Outputs.Success()\n\n}"},"ports":[{"name":"in-email","displayName":"email","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-password","displayName":"password","plug":"input","type":"*","group":"Inputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":7},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":8},{"name":"out-data","displayName":"data","plug":"output","type":"*","group":"Outputs","index":9}],"children":[]},{"id":"ef278919-5e09-c1e9-d63a-0262741418d1","type":"Event Sender","parameters":{"channelName":"Supabase User Logged In"},"ports":[],"children":[]},{"id":"2227ed5c-1a16-6385-333a-dde9a8287fe4","type":"JavaScriptFunction","parameters":{"functionScript":"if(!Inputs.Triggered)return\r\nif (!Boolean(Noodl.Variables.supabase)) {\r\n    console.error(\"Supabase client not initialized\")\r\n    return\r\n}\r\nconst email = Inputs.Email\r\ntry {\r\n\r\n    let userProfileTable = Noodl.Variables.Supabase_userProfileTableName\r\n\r\n    const { data, error } = await Noodl.Variables.supabase\r\n        .from(userProfileTable)\r\n        .select()\r\n        .eq(\"login_email\", email)\r\n\r\n    if (data.length > 0) {\r\n        if (data[0].enable == false) {\r\n            Outputs.Disable()\r\n        }\r\n        else {\r\n            Outputs.Success()\r\n        }\r\n\r\n    } else {\r\n        Outputs.error = \"No such user\" + error\r\n        Outputs.NoUserData()\r\n    }\r\n\r\n} catch (error) {\r\n    console.error(error)\r\n    Outputs.Failure()\r\n}\r\n"},"ports":[{"name":"in-Triggered","displayName":"Triggered","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Email","displayName":"Email","plug":"input","type":"*","group":"Inputs","index":5},{"name":"out-Disable","displayName":"Disable","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":7},{"name":"out-NoUserData","displayName":"NoUserData","plug":"output","type":"signal","group":"Outputs","index":8},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":9},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":10}],"children":[]},{"id":"53e20a2a-0aee-922f-56f2-896268618cf7","type":"/#component/Show Toast","parameters":{"Type":"Warning","Message":"This User is disabled"},"ports":[],"children":[]}],"connections":[{"sourceId":"b643f904-ecb4-5bb2-8194-f6fdc77726fa","sourcePort":"Email","targetId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","targetPort":"in-email"},{"sourceId":"b643f904-ecb4-5bb2-8194-f6fdc77726fa","sourcePort":"Password","targetId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","targetPort":"in-password"},{"sourceId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","sourcePort":"out-Failure","targetId":"d54e86b2-f075-cf9e-e60e-54fec7d955b4","targetPort":"Failure"},{"sourceId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","sourcePort":"out-error","targetId":"d54e86b2-f075-cf9e-e60e-54fec7d955b4","targetPort":"Error"},{"sourceId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","sourcePort":"out-Success","targetId":"d54e86b2-f075-cf9e-e60e-54fec7d955b4","targetPort":"Success"},{"sourceId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","sourcePort":"out-Success","targetId":"ef278919-5e09-c1e9-d63a-0262741418d1","targetPort":"sendEvent"},{"sourceId":"b643f904-ecb4-5bb2-8194-f6fdc77726fa","sourcePort":"Email","targetId":"2227ed5c-1a16-6385-333a-dde9a8287fe4","targetPort":"in-Email"},{"sourceId":"b643f904-ecb4-5bb2-8194-f6fdc77726fa","sourcePort":"Do","targetId":"2227ed5c-1a16-6385-333a-dde9a8287fe4","targetPort":"in-Triggered"},{"sourceId":"2227ed5c-1a16-6385-333a-dde9a8287fe4","sourcePort":"out-Success","targetId":"a131d572-4e2d-b639-84f1-9dcbdffeadb2","targetPort":"run"},{"sourceId":"2227ed5c-1a16-6385-333a-dde9a8287fe4","sourcePort":"out-Disable","targetId":"53e20a2a-0aee-922f-56f2-896268618cf7","targetPort":"Do"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Do","type":"*","group":"Inputs","plug":"input","index":0},{"name":"Failure","type":"signal","plug":"output","index":1},{"name":"Email","type":{"name":"*"},"group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"Password","type":"*","group":"Inputs","plug":"input","index":2},{"name":"Error","type":"*","plug":"output","index":3}],"roots":[]}]